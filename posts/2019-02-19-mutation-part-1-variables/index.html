<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=//gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.54.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Mutation - Part 1: Variables &middot; Another one bytes the Rust!</title><link type=text/css rel=stylesheet href=https://danielhenrymantilla.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://danielhenrymantilla.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://danielhenrymantilla.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://danielhenrymantilla.github.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png><link href rel=alternate type=application/rss+xml title="Another one bytes the Rust!"></head><body class="theme-base-08 layout-reverse"><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://danielhenrymantilla.github.io/><h1>Another one bytes the Rust!</h1></a><p class=lead>Thoughts and ramblings for the like-minded</p></div><nav><ul class=sidebar-nav><li><a href=https://danielhenrymantilla.github.io/>Home</a></li><li><a href=/series>Blog Post Series</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></nav><p>&copy; 2019. All rights reserved.</p></div></aside><main class="content container"><style>.button{display:inline-block;border-radius:40px;background-color:#ac4142;border:none;color:#fff;text-align:center;font-size:18px;padding:10px;width:140px;transition:all .5s;cursor:pointer;box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}.button span{cursor:pointer;display:inline-block;position:relative;transition:.5s}.next-button span:after{content:'\00bb';position:absolute;opacity:0;top:0;right:-20px;transition:.5s}.next-button:hover span{padding-right:25px}.next-button:hover span:after{opacity:1;right:0}.prev-button span:after{content:'\00ab';position:absolute;opacity:0;top:0;left:-20px;transition:.5s}.prev-button:hover span{padding-left:25px}.prev-button:hover span:after{opacity:1;left:0}.nohover:hover{text-decoration:none currentcolor solid}</style><div style=text-align:center;padding-top:0;padding-bottom:40px><a class=nohover style=display:inline-block;float:left href=/posts/2019-02-19-mutation-part-0-intro/><button class="button prev-button">
<span>Prev post</span></button>
</a><a class=nohover style=display:inline-block;float:right href=/posts/2019-02-19-mutation-part-2-to-mut-or-not-to-mut/><button class="button next-button">
<span>Next post</span></button></a><div style=clear:both></div></div><hr><div class=post><h1>Mutation - Part 1: Variables</h1><time datetime=2019-02-17T15:07:48&#43;0100 class=post-date>Sun, Feb 17, 2019</time><h1 id=what-is-a-variable>What is a variable?</h1><p>Ok, here there is really a lot that could be said, and a simple blog post will not cover it. I will just talk about <strong>two important and distinct thinking patters</strong> involved:</p><ol><li><p>the idea of <em>binding a name to a value</em>;</p></li><li><p>the idea of reading/writing values from/into memory;</p></li></ol><h2 id=1-a-variable-as-an-identity-binding>1. A variable as an <em>identity binding</em></h2><p>The best example in Rust for &ldquo;just a binding&rdquo; (<em>i.e.</em>, with <strong>no backing memory</strong>) is <code>const</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#080;font-weight:700>type</span> <span style=color:#b06;font-weight:700>is</span><span style=color:#bbb> </span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#339;font-weight:700>i32</span>;<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#bbb></span><span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>x<span style=color:#bbb>          </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span><span style=color:#333>+</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>27</span>;<span style=color:#bbb>
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#bbb></span><span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>;<span style=color:#bbb>
</span></span></code></pre></td></tr></table></div></div><p>Here we have defined <code>the_answer</code> as an <em>alias</em> for the value <code>42</code>; meaning that, from now on, everytime we say <code>the_answer</code> what we actually mean is <code>42</code>.</p><p>We are at the <a href=/tags/meta-programming>meta</a> level: if we ask the program to evaluate <code>x</code>, what we are actually<sup class=footnote-ref id=fnref:1><a href=#fn:1>1</a></sup> asking the program to do is to evaluate <code>the_answer + 27</code>, <em>i.e.</em>, to evaluate <code>42 + 27</code>.</p><p>The same in C, with <code>#define</code>:<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#579>#define x          (the_answer + 27)
</span></span><span style=color:#579></span>
<span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#579>#define the_answer (42)</span></span></code></pre></td></tr></table></div></div></p><p>If you look at both code snippets, you can notice that there is no notion of temporality (regarding the definitions):</p><blockquote><p>It is all about <em>essence</em> / <em>identity</em>.</p></blockquote><p>Thus, if <code>the_answer</code> <em>is</em> and <em>will always be</em> <code>42</code>, <strong>there is no room for <em>mutation</em></strong>.</p><ul><li><p><code>42</code> cannot mutate and become <code>43</code>; <code>42</code> is and will always be
<code>1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 1 + 0</code><sup class=footnote-ref id=fnref:2><a href=#fn:2>2</a></sup></p></li><li><p>in a similar manner, <code>the_answer</code> cannot change either, since it was defined as <strong>being</strong> (identity) <code>42</code>:</p><p><img src=https://i.imgflip.com/2tx145.jpg alt="One does not simply change an identity"></p></li><li><p>and yet &hellip; we feel like we should be able to redefine what <code>the_answer</code> is, don&rsquo;t we?</p><blockquote><p><strong>re-define</strong>?</p></blockquote><ul><li><p>This implies some form of temporality, and for that there are two solutions:</p><ol><li><p>scoped bindings (and shadowing).</p></li><li><p>a binding to (runtime) memory.</p></li></ol></li></ul></li></ul><h3 id=1-1-scoped-bindings>1.1 Scoped bindings</h3><p>You can limit the &ldquo;scope&rdquo; of your identity-definition:<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=color:#888>// undefined
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#888></span>{<span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>;<span style=color:#bbb>
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#bbb>    </span><span style=color:#888>// defined
</span></span><span style=color:#888></span>}<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#888>// undefined
</span></code></pre></td></tr></table></div></div></p><p>This is one of the ways to have some form of temporality with bindings: time progresses as we enter and leave scopes.<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust>{<span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>;<span style=color:#bbb>
</span><span style=color:#bbb>    </span>{<span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>x<span style=color:#bbb> </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span><span style=color:#333>+</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>27</span>;<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:#888>// x -&gt; the_answer + 27 -&gt; 42 + 27
</span><span style=color:#888></span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></code></pre></td></tr></table></div></div></p><blockquote><p>But what about <strong>re-defining</strong> <code>the_answer</code>?</p></blockquote><p>By using a narrower scope, we can indeed <em>re-define</em> the value of <code>the_answer</code>, even though what we are actually doing is defining a brand new <code>the_answer</code> that happens to lead to a name collision. But given the different scopes and their temporality, this is unambiguous and thus allowed:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust>{<span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>;<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#888>// &#39;the_answer&#39; &lt;-&gt; 42
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#888></span><span style=color:#bbb>    </span>{<span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span>:<span style=color:#b06;font-weight:700>is</span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>0</span>;<span style=color:#bbb>
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#bbb>        </span><span style=color:#888>// &#39;the_answer&#39; &lt;-&gt; 0
</span></span><span style=color:#888></span><span style=color:#bbb>    </span>}<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#888>// &#39;the_answer&#39; &lt;-&gt; 42
</span><span style=color:#888></span>}<span style=color:#bbb>
</span></code></pre></td></tr></table></div></div><p>This trick is called <strong>shadowing</strong> and is a clever way to avoid using mutation when it is not needed.</p><h2 id=2-runtime-memory>2. Runtime memory</h2><p>We are so used to manipulating memory through variables that I have written a program, with some primitives / intrinsics that allow us to read/write from/into the memory and also to print values:</p><blockquote><p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8600d8759a62adcad18f97792c5a85cd">Playground</a></p></blockquote><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style=color:#080;font-weight:700>fn</span> <span style=color:#06b;font-weight:700>main</span><span style=color:#bbb> </span>()<span style=color:#bbb>
</span><span style=color:#bbb></span>{<span style=color:#bbb>
</span><span style=color:#bbb>    </span>WRITE<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1000</span>,<span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>);<span style=color:#bbb>
</span><span style=color:#bbb>    </span>WRITE<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1001</span>,<span style=color:#bbb> </span><span style=color:#00d;font-weight:700>27</span>);<span style=color:#bbb>
</span><span style=color:#bbb>    </span>PRINT<span style=color:#333>!</span>(READ<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1000</span>));<span style=color:#bbb> </span><span style=color:#888>// -&gt; 42
</span><span style=color:#888></span><span style=color:#bbb>    </span>WRITE<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1000</span>,<span style=color:#bbb> </span>READ<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1000</span>)<span style=color:#bbb> </span><span style=color:#333>+</span><span style=color:#bbb> </span>READ<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1001</span>));<span style=color:#bbb>
</span><span style=color:#bbb>    </span>PRINT<span style=color:#333>!</span>(READ<span style=color:#333>!</span>(<span style=color:#00d;font-weight:700>1000</span>));<span style=color:#bbb> </span><span style=color:#888>// -&gt; 69
</span><span style=color:#888></span>}<span style=color:#bbb>
</span></code></pre></td></tr></table></div></div><p>This way, we can see that we were able to</p><ol><li><p>write at the address <code>1000</code> the value <code>42</code>;</p></li><li><p>then write at that same address the value <code>69</code>.</p></li></ol><p><strong>We have successfully mutated something!</strong></p><p>So, now we have a clearer understanding of what <em>mutation</em> actually is:
modifying <strong>memory contents</strong>.</p><p>But what have variables to do with any of this?</p><h3 id=2-1-runtime-memory-with-variables>2.1 Runtime memory with variables</h3><p>The following sentence explains the relation between bindings and memory:</p><blockquote><p>A (runtime) variable is a (static) binding to some place in memory, and is used to read/write from/into that place in memory</p></blockquote><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>at_the_answer: <span style=color:#b06;font-weight:700>address</span><span style=color:#bbb> </span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>1000</span>;<span style=color:#bbb>
</span></span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#bbb></span><span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>at_x: <span style=color:#b06;font-weight:700>address</span><span style=color:#bbb> </span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>1001</span>;<span style=color:#bbb>
</span></span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>fn</span> <span style=color:#06b;font-weight:700>main</span><span style=color:#bbb> </span>()<span style=color:#bbb>
</span><span style=color:#bbb></span>{<span style=color:#bbb>
</span><span style=color:#bbb>    </span>WRITE<span style=color:#333>!</span>(at_the_answer,<span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>);<span style=color:#bbb>
</span><span style=color:#bbb>    </span>WRITE<span style=color:#333>!</span>(at_x,<span style=color:#bbb> </span><span style=color:#00d;font-weight:700>27</span>);<span style=color:#bbb>
</span><span style=color:#bbb>    </span>PRINT<span style=color:#333>!</span>(READ<span style=color:#333>!</span>(at_the_answer));<span style=color:#bbb> </span><span style=color:#888>// -&gt; 42
</span><span style=color:#888></span><span style=color:#bbb>    </span>WRITE<span style=color:#333>!</span>(at_the_answer,<span style=color:#bbb> </span>READ<span style=color:#333>!</span>(at_the_answer)<span style=color:#bbb> </span><span style=color:#333>+</span><span style=color:#bbb> </span>READ<span style=color:#333>!</span>(at_x));<span style=color:#bbb>
</span><span style=color:#bbb>    </span>PRINT<span style=color:#333>!</span>(READ<span style=color:#333>!</span>(at_the_answer));<span style=color:#bbb> </span><span style=color:#888>// -&gt; 69
</span><span style=color:#888></span>}<span style=color:#bbb>
</span></code></pre></td></tr></table></div></div><p>And now with some sugar:</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Rust data-lang=Rust><span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>at_the_answer: <span style=color:#b06;font-weight:700>address</span><span style=color:#bbb> </span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>1000</span>;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#080;font-weight:700>const</span><span style=color:#bbb> </span>at_x: <span style=color:#b06;font-weight:700>address</span><span style=color:#bbb> </span><span style=color:#333>=</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>1001</span>;<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span>main<span style=color:#333>!</span><span style=color:#bbb> </span>{<span style=color:#bbb>
</span><span style=color:#bbb>    </span>the_answer<span style=color:#bbb> </span><span style=color:#333>&lt;-</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>42</span>;<span style=color:#bbb>
</span><span style=color:#bbb>    </span>x<span style=color:#bbb> </span><span style=color:#333>&lt;-</span><span style=color:#bbb> </span><span style=color:#00d;font-weight:700>27</span>;<span style=color:#bbb>
</span><span style=color:#bbb>    </span>PRINT<span style=color:#333>!</span>(the_answer);<span style=color:#bbb> </span><span style=color:#888>// -&gt; 42
</span><span style=display:block;width:100%;background-color:#e5e5e5><span style=color:#888></span><span style=color:#bbb>    </span>the_answer<span style=color:#bbb> </span><span style=color:#333>&lt;-</span><span style=color:#bbb> </span>the_answer<span style=color:#bbb> </span><span style=color:#333>+</span><span style=color:#bbb> </span>x;<span style=color:#bbb>
</span></span><span style=color:#bbb>    </span>PRINT<span style=color:#333>!</span>(the_answer);<span style=color:#bbb> </span><span style=color:#888>// -&gt; 69
</span><span style=color:#888></span>}<span style=color:#bbb>
</span></code></pre></td></tr></table></div></div><p>How does that sugar work? Let&rsquo;s describe the unsugaring of line <code>139</code>:</p><ul><li><p>The statement <code>the_answer &lt;- the_answer + x;</code> is identified as an <strong>assignment</strong>:
a value (right hand side) is written to memory (left hand side)</p><ol><li><p>First the right hand side of the assignment (<code>the_answer + x</code>) is treated,
and every variable occurrence is replaced with <strong>READ</strong> memory access:</p><ul><li><p><code>the_answer</code> becomes <code>READ!(at_the_answer)</code></p></li><li><p><code>x</code> becomes <code>READ!(at_x)</code></p></li></ul></li><li><p>Then the left hand side of the assignment (<code>the_answer</code>) is treated,
and the variable is replaced with a <strong>WRITE</strong> memory access:</p><ul><li><code>the_answer &lt;- ...</code> becomes <code>WRITE!(at_the_answer, ...)</code></li></ul></li></ol></li><li><p>We end up with the following unsugaring:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust>WRITE<span style=color:#333>!</span>(at_the_answer,<span style=color:#bbb> </span>READ<span style=color:#333>!</span>(at_the_answer)<span style=color:#bbb> </span><span style=color:#333>+</span><span style=color:#bbb> </span>READ<span style=color:#333>!</span>(at_x))<span style=color:#bbb>
</span></code></pre></div></li></ul><h2 id=appendix>Appendix</h2><h4 id=full-unsugaring-code-rust-sugar>Full <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f2188870128fa978c005c9a32eab84a3">unsugaring code</a></h4><script type=text/javascript src=http://gist.github.com/f2188870128fa978c005c9a32eab84a3.js></script><div class=footnotes><hr><ol><li id=fn:1><em>i.e.</em>, on runtime
<a class=footnote-return href=#fnref:1><sup>[return]</sup></a></li><li id=fn:2>The representation of a number (here in base ten) vs its <em>true</em> nature is a (very interesting) topic in and on itself, which will most probably deserve its own blog post. One great definition / view of a (natural) number&rsquo;s nature is Peano&rsquo;s arithmetic, with which one can <em>prove</em> that <code>1+1+0 + 1+1+0 = 1+1+1+1+0</code>
<a class=footnote-return href=#fnref:2><sup>[return]</sup></a></li></ol></div><hr><style>.button{display:inline-block;border-radius:40px;background-color:#ac4142;border:none;color:#fff;text-align:center;font-size:18px;padding:10px;width:140px;transition:all .5s;cursor:pointer;box-shadow:0 8px 16px 0 rgba(0,0,0,.2),0 6px 20px 0 rgba(0,0,0,.19)}.button span{cursor:pointer;display:inline-block;position:relative;transition:.5s}.next-button span:after{content:'\00bb';position:absolute;opacity:0;top:0;right:-20px;transition:.5s}.next-button:hover span{padding-right:25px}.next-button:hover span:after{opacity:1;right:0}.prev-button span:after{content:'\00ab';position:absolute;opacity:0;top:0;left:-20px;transition:.5s}.prev-button:hover span{padding-left:25px}.prev-button:hover span:after{opacity:1;left:0}.nohover:hover{text-decoration:none currentcolor solid}</style><div style=text-align:center;padding-top:0;padding-bottom:40px><a class=nohover style=display:inline-block;float:left href=/posts/2019-02-19-mutation-part-0-intro/><button class="button prev-button">
<span>Prev post</span></button>
</a><a class=nohover style=display:inline-block;float:right href=/posts/2019-02-19-mutation-part-2-to-mut-or-not-to-mut/><button class="button next-button">
<span>Next post</span></button></a><div style=clear:both></div></div></main></body></html>